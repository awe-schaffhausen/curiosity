(function(f){function e(){}for(var h="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),g;!!(g=h.pop());){f[g]=f[g]||e}})(function(){try{console.log();return window.console}catch(b){return(window.console={})}}());$(document).ready(function(){if($.browser.msie&&parseInt($.browser.version,10)<7){$("body").supersleight({shim:"img/transparent.gif"})}});var camera,environ,renderer,heylookatme;var mouseX=0,mouseY=0;var imgcounter=0,imgperscenecounter=0,movementfactor=2,scrollfactor=0;var mi_x,mi_y,mi_z,depth,initial,distance=0,time_a,time_b,smoothslide;var stance=true,dragging=false;var gather=[],x_dir_a=[],y_dir_a=[],x_dir_b=[],y_dir_b=[],storyheight=[];var $windowpane=$(window);var $papercut=$("#papercut");var paneheight,panewidth;$(document).ready(function(){paneheight=$windowpane.height();panewidth=$windowpane.width();glideheight=paneheight/movementfactor;glidewidth=panewidth/movementfactor});$windowpane.load(function(){$papercut.css({top:($windowpane.height()-672)/2,left:($windowpane.width()-1024)/2});desolate_init(cutouts)});$windowpane.resize(function(){paneheight=$windowpane.height();panewidth=$windowpane.width()});window.onorientationchange=function(){paneheight=$windowpane.height();panewidth=$windowpane.width();$(".master").css({height:paneheight,width:panewidth})};function dimensional_init(){$(".story").find("div").each(function(b){var a=$(this);if(a.hasClass("right")){a.css("left",(panewidth-300)*0.8)}else{if(a.hasClass("left")){a.css("left",(panewidth-300)*0.2)}}storyheight[b]=$(this).height()});environ=new THREE.Scene();renderer=new THREE.CSS3DRenderer();renderer.setSize(1024,673);renderer.domElement.style.position="absolute";renderer.domElement.style.top=0;renderer.domElement.style.overflow="inherit";$papercut.append(renderer.domElement);document.addEventListener("mousemove",onDocumentMouseMove,false);heylookatme=new THREE.Vector3(150,0,220);camera=new THREE.PerspectiveCamera(35,1024/673,1,10000);camera.position.z=1000;camera.lookAt(heylookatme);papergenerator(cutouts);if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)){depth=200;shifter(depth,true)}else{depth=20;shifter(depth)}dimensional();animate()}function papergenerator(g){var f=1;for(var e in g){var b=g[e];for(var d in b){var a=document.createElement("div");a.className="shape scene_"+e+" img_"+imgperscenecounter+" obj_"+imgcounter.toString();imgcounter++;imgperscenecounter++;var c=new THREE.CSS3DObject(a);c.position.x=700*b[d].x_a;c.position.y=700*b[d].y_a;c.position.z=d*35;environ.add(c);x_dir_a.push(b[d].x_a);x_dir_b.push(b[d].x_b);y_dir_a.push(b[d].y_a);y_dir_b.push(b[d].y_b)}f++;gather[e]=imgperscenecounter;imgperscenecounter=0}}function onDocumentMouseMove(a){mouseX=(a.clientX-glidewidth)/3;mouseY=(a.clientY-glideheight)/3}function animate(){render();requestAnimationFrame(animate);TWEEN.update()}function render(){camera.position.x+=(mouseX-camera.position.x)*0.05;camera.position.y+=(-mouseY+200-camera.position.y)*0.05;camera.lookAt(heylookatme);renderer.render(environ,camera)}$windowpane.mousewheel(function(c,d,b,a){depth+=-a+scrollfactor;shifter(depth)});window.addEventListener("touchstart",touchStart,false);window.addEventListener("touchmove",touchMove,false);window.addEventListener("touchend",touchEnd,false);function touchStart(a){initial=a.pageY;time_a=new Date().getTime()}function touchMove(a){a.preventDefault();if(a.touches.length==1){dragging=true;distance=a.pageY-initial;shifter(depth+distance,true)}else{dragging=false}}function touchEnd(c){if(dragging){dragging=false;time_b=new Date().getTime();var a=(distance/(time_b-time_a))*100;depth+=distance;var b=new TWEEN.Tween({g:depth}).to({g:depth+a},300).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function(){shifter(this.g,true)}).start();setTimeout(function(){depth+=a},300)}}$("#reset").on("click",function(){stance=true});window.ondevicemotion=function(a){if(stance){mi_x=a.accelerationIncludingGravity.x;mi_y=a.accelerationIncludingGravity.y;mi_z=a.accelerationIncludingGravity.z;stance=false}mouseY=(a.accelerationIncludingGravity.x-mi_x)*30;mouseX=(a.accelerationIncludingGravity.y-mi_y)*60};var shift=20,sceneposition,sceneregulate,scenebracket=0;function sign(a){return a?a<0?-1:1:0}function shifttocoord(b,d){var a=d*(-((shift+20)/20)+2);var c=sign(a)*(1-Math.cos(a));return c}function shifttoopacity(a){return(1-(Math.abs(a-20)/20))}function shifter(b,g){if(b>=20){var c;if(g){c=b/10}else{c=b}shift=Math.floor(c%40);sceneposition=Math.floor(c/40);for(var a=scenebracket;a<gather[sceneposition]+scenebracket;a++){if(shift<=20){environ.children[a].position.x=shifttocoord(shift,x_dir_a[a])*700;environ.children[a].position.y=shifttocoord(shift,y_dir_a[a])*700}else{environ.children[a].position.x=-shifttocoord(shift,x_dir_b[a])*700;environ.children[a].position.y=-shifttocoord(shift,y_dir_b[a])*700}}$("#s_"+sceneposition).css({top:(shifttocoord(shift,1)*(paneheight+storyheight[sceneposition]))+(paneheight*0.45),opacity:shifttoopacity(shift)});$(".scene_"+(sceneposition)).css("opacity",shifttoopacity(shift));if(sceneposition!=sceneregulate){scenebracket=0;var d=gather.slice(0,sceneposition+1);for(var f=0;f<d.length-1;f++){scenebracket+=d[f]}for(var e=0;e<gather.length;e++){e!=sceneposition&&$(".scene_"+e+", .what, .whom").css({opacity:0,display:"none"})}$("#s_"+sceneposition).css({opacity:1,display:"block"});$(".scene_"+sceneposition).css("display","block")}sceneregulate=sceneposition}}var IEcenters=[],dft,midpoint,mpe;function desolate_init(f){$windowpane.scrollTop(0);$papercut.append('<div id="desolation"></div>');var e=1;midpoint=paneheight*0.55;mpe=paneheight/2;for(var d in f){var a=f[d];for(var c in a){$("#desolation").append('<div class="shape scene_'+d+'" id="img_'+imgperscenecounter+'" style="left:'+(700*a[c].x_a)+"px; top:"+(700*a[c].y_a)+'px;"></div>');imgperscenecounter++;x_dir_a.push(a[c].x_a);x_dir_b.push(a[c].x_b);y_dir_a.push(a[c].y_a);y_dir_b.push(a[c].y_b)}e++;gather[d]=imgperscenecounter;imgperscenecounter=0}$(".story").find("div").each(function(k){var j=k+1;var i=$(this);i.css({top:(paneheight*j)-(paneheight*0.55),left:(panewidth-300)*0.8});IEcenters[k]=(paneheight*j)-(paneheight*0.55)}).parent().css("height",($(".story").find("div").size()*paneheight));$(window).scroll(function(i){dft=$windowpane.scrollTop();g(dft+mpe)});function b(j,l){var i=l*(-((shift+mpe)/mpe)+2);var k=sign(i)*(1-Math.cos(i));console.log(k);return k}var h=$(".scene_"+sceneposition);function g(j){shift=Math.floor(j%paneheight);sceneposition=Math.floor(j/paneheight);console.log(shift+" >> "+sceneposition);for(var i=0;i<gather[sceneposition];i++){console.log();if(shift<=midpoint){h.find("#img_"+i).css({left:(-((shift+mpe)/mpe)+2),top:(-((shift+mpe)/mpe)+2)})}else{h.find("#img_"+i).css({left:-(-((shift+mpe)/mpe)+2),top:-(-((shift+mpe)/mpe)+2)})}}$(".scene_"+(sceneposition)).css("opacity",(shift/paneheight));if(sceneposition!=sceneregulate){$(".shape").css("display","none");$(".scene_"+sceneposition).css("display","block")}sceneregulate=sceneposition}};